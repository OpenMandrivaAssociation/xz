diff -Naur xz-5.2.4/Makefile.am xz-5.2.4.tpg/Makefile.am
--- xz-5.2.4/Makefile.am	2018-04-29 15:10:38.000000000 +0000
+++ xz-5.2.4.tpg/Makefile.am	2019-03-26 20:34:46.360000000 +0000
@@ -108,3 +108,11 @@
 	fi; \
 	TAR_OPTIONS='--owner=0 --group=0 --numeric-owner --mode=u+rw,go+r-w' \
 		$(MAKE) VERSION="$$VERSION" dist-gzip
+
+pgo-build:
+	$(MAKE) clean
+	find . -type f -name "*.profile*" -delete ||:
+	LLVM_PROFILE_FILE="xz-%p.profile.d" $(MAKE) check CFLAGS="${CFLAGS} -fprofile-instr-generate" CXXFLAGS="${CXXFLAGS} -fprofile-instr-generate" LDFLAGS="${LDFLAGS} -fprofile-instr-generate"
+	llvm-profdata merge -output=xz.profile ./tests/*.profile.d
+	$(MAKE) clean
+	$(MAKE) check CFLAGS="${CFLAGS} -fprofile-instr-use=$(realpath ${srcdir}/xz.profile)" CXXFLAGS="${CXXFLAGS} -fprofile-instr-use=$(realpath ${srcdir}/xz.profile)" LDFLAGS="${LDFLAGS} -fprofile-instr-use=$(realpath ${srcdir}/xz.profile)"
